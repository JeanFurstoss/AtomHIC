This documentation explains how to reproduce the Steinhardt Gaussian Mixture Analysis (SGMA) methodology presented in Furstoss et al. (Computer Physics Communications 2025)
The objective of the SGMA is to identify crystals, defects or other local atomic environments using a data-driven methodology. 
In its first formulation it uses Steinhardt parameters as descriptors but given the structure of AtomHIC it could be easily used with other descriptors.

The SGMA lies with 3 main steps and are associated with 3 AtomHIC executables:

1. Construction of the database:

A database containing the different local atomic environments (called Labels in the code) to identify has to be constructed. For this, it is recommanded to:
	A. Make a molecular dynamics simulation of each local environment with temperature ranking from 0K to a given temperature and dump regularly the atomic positions.
	B. Compute the Steinhardt descriptors for all dumps. This step can be achieved using the "ComputeDescriptors" executable
	C. In each dump, select only the atoms you consider to belonging to the desired local atomic environment. This step can be helped by using a criterium on some Steinhardt descriptors
	D. Arrange all files in a directory, let say DATABASE/, and subdirectories reprensenting the labels, such that DATABASE/Label1/ contains all dump files with the selected atoms belonging to Label1 and their associated descriptors

2. Fitting and labeling the Gaussian Mixture Model

This step can be achieved using the "FitAndSaveGMM" executable (or with the /tools/PythonTools/FitAndSaveGMM.py python script using the sklearn implementation of GMM tools), which will take as argument the name of the directory containing the labels subdirectories containing the dump files (see first step)
This executable take also in argument the number of cluster minimum and maximum for the estimation of the optimal number of cluster (based on BIC minimization), it is recommanded to put the minimum number of cluster equal to the number of label in the database.
The last argument of this executable is the name of the directory, let say MY_GMM_MODEL, in which the optimized parameters of the Gaussian Mixture Model will be stored (i.e. in /data/MachineLearningModels/GaussianMixtureModel/MY_GMM_MODEL). These parameters will then be used in the third step to make the structural analysis.
Depending on the dimension of descriptors, number of input data and number of clusters, the fitting of the GMM can take a while. The tolerance and maximum iterations for the EM and KMeans algorithm, which are used for this fitting, can be tuned by editing a FixedParameters.ath file (example of parameters described in /data/FixedParameters/FixedParameter.ath) to save computational time but may result in poorer optimization.


3. Structural analysis

This step is can be performed using the "GMMClassification" executable.
This executable takes an atomic system as input plus the name of the GMM model optimized in step 2 (MY_GMM_MODEL).
If the descriptors are provided directly in the atomic file, be sure that they have been computed using exactly the same descriptors properties than the one used for the construction of the database (in this case, AtomHIC will output some warnings).
If the descriptors are not provided AtomHIC will compute them using the descriptors properties stored in the database (see note B) and store them in the output file.
The output file will contain an auxiliary property named Struct containing in the first column, the index of the most probable label (the correspondance between the label index and the label name is provided in the StructureIndex.txt file also generated by the executable) and in the second column the value of the maximum likelihood classifier.

Notes:

A. 
Some filtering could be applied to the model (this could be set with the FILTERING_TYPE keyword in a FixedParameters.ath file), meaning that separate GMM will be fitted for the different values of the filter. 
When the filtering is based on atomic species, it is much better to store the element names than the types (based on integers), which can change depending on the convention.
Nevertheless the element names are not always given in the atomic files. 
To overpass this issue without modifying the atomic files, AtomHIC can read a "Type2Element.ath" file in the working directory allowing to affect a type to a given element name.
An example of such file can be found in /data/ExampleFiles/Type2Element.ath

B.
In step 2, the informations on Steinhardt descriptors properties (e.g. cutoff radius, average style) can be lost and thus not stored in the database informations. As these informations are very important for step 3, it is much better to store them. To do so, a "DescriptorProperties.ath" file could be put in the DATABASE/ directory (constructed in step 1). A example of this file can be found in /data/ExampleFiles/ but this file is also automatically generated from the ComputeDescriptors executable and could thus be directly copied to the wanted directory.

C. 
The GMM databases used in Furstoss et al. can directly be used (step 3) to analyse alumine and forsterite systems, their names are ForsteriteDefects_Furstoss_CompPhysCom and AluminePhase_Furstoss_CompPhysCom

D. 
All the AtomHIC executables used for the SGMA have a helped print which is displayed when running the executable without argument. This printed can help if some difficulties are encountered, if it is not enough, please feel free to contact jfurstoss@orange.fr

E.
For the two first steps described above it can be tricky to both find the right cutoff radius and spherical harmonics degree and to adjust correclty the number of cluster during the GMM fitting. In order to help, two graphical tools have been developed allowing to visualize the database and the fitted GMM. These visualization python scripts could be found in /tools/PythonTools/PlotGMMModel_Matrix.py and /tools/PythonTools/PlotGMMModel_violin.py
